---
import Footer from '../../components/Footer.astro';
import '../../styles/home.css';
import '../../styles/components/footer.css';
---

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ton rappel quotidien - Sorrel</title>
</head>
<body>
    <div class="container">
        <canvas id="curveCanvas"></canvas>
               

        <div class="greeting-section">
            <img class="sorrel-pic" src="../sorrel/pandaNormal.png" alt="Sorrel" id="currentAvatar"/>

            <div class="main-card-header">
                <div>Ton rappel quotidien</div>
            </div>
            
            <div class="main-card">
                <div class="time-section">
                    <p>Matin</p>
                    <div class="medication-item">
                        <div class="medication-icon">ðŸ’Š</div>
                        <div class="medication-info">
                            <div class="medication-name">MÃ©dicament 1</div>
                            <div class="medication-dose">1/jour ?</div>
                        </div>
                        <div class="medication-toggle">
                            <div class="toggle-switch"></div>
                        </div>
                    </div>
                </div>
                
                <div class="time-section">
                    <p>Midi</p>
                    <div class="medication-item">
                        <div class="medication-icon">ðŸ’Š</div>
                        <div class="medication-info">
                            <div class="medication-name">MÃ©dicament 2</div>
                            <div class="medication-dose">2/jour ?</div>
                        </div>
                        <div class="medication-toggle">
                            <div class="toggle-switch"></div>
                        </div>
                    </div>
                </div>

                <div class="time-section">
                    <p>Midi</p>
                    <div class="medication-item">
                        <div class="medication-icon">ðŸ’Š</div>
                        <div class="medication-info">
                            <div class="medication-name">MÃ©dicament 2</div>
                            <div class="medication-dose">2/jour ?</div>
                        </div>
                        <div class="medication-toggle">
                            <div class="toggle-switch"></div>
                        </div>
                    </div>
                </div><div class="time-section">
                    <p>Midi</p>
                    <div class="medication-item">
                        <div class="medication-icon">ðŸ’Š</div>
                        <div class="medication-info">
                            <div class="medication-name">MÃ©dicament 2</div>
                            <div class="medication-dose">2/jour ?</div>
                        </div>
                        <div class="medication-toggle">
                            <div class="toggle-switch"></div>
                        </div>
                    </div>
                </div>
                
                <div class="time-section">
                    <p>Soir</p>
                    <div class="medication-item">
                        <div class="medication-icon">ðŸ’Š</div>
                        <div class="medication-info">
                            <div class="medication-name">MÃ©dicament 3</div>
                            <div class="medication-dose">1/jour ?</div>
                        </div>
                        <div class="medication-toggle">
                            <div class="toggle-switch active"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <Footer />
    </div>

    <script src="/scripts/checkAuth.js" is:inline></script>

   <script>
    let currentUser = null;

    // Liste des avatars disponibles (reprend celle de la page profil)
    const availableAvatars = [
        { id: 'normal', src: '/sorrel/pandaNormal.png', name: 'Normal' },
        { id: 'medicament', src: '/sorrel/pandaMedicine.png', name: 'Medicament' },
        { id: 'happy', src: '/sorrel/pandaPawsUp.png', name: 'Heureux' },
        { id: 'ordo', src: '/sorrel/pandaPrescription.png', name: 'Le medecin' },
        { id: 'bonjour', src: '/sorrel/pandSayingHi.png', name: 'Bonjour' },
        { id: 'plante', src: '/sorrel/pandaWithPlant.png', name: "L'herboriste" },
        { id: 'reflechis', src: '/sorrel/pandThinking.png', name: "Le penseur" },
    ];

    // Charger le profil utilisateur
    async function loadProfile() {
        try {
            const response = await fetch('http://localhost:8080/auth/me', {
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error('Non authentifiÃ©');
            }

            currentUser = await response.json();
            loadUserAvatar();

        } catch (error) {
            console.error('Erreur chargement profil:', error);
            window.location.href = '/connexion/connexion';
        }
    }

    // Charger l'avatar de l'utilisateur
    function loadUserAvatar() {
        const userAvatar = currentUser.avatar || 'normal';
        const avatarData = availableAvatars.find(avatar => avatar.id === userAvatar);

        if (avatarData) {
            const avatarImg = document.getElementById('currentAvatar');
            avatarImg.src = avatarData.src;
            avatarImg.alt = avatarData.name;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadProfile();

        // Interaction avec les toggles de mÃ©dicaments
        document.querySelectorAll('.toggle-switch').forEach(toggle => {
            toggle.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });
    });

    // Code existant pour le canvas
    const canvas = document.getElementById('curveCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        drawCurve();
    }

    function drawCurve() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.moveTo(0, canvas.height * 0.2);
        ctx.bezierCurveTo(canvas.width * 0.8, canvas.height * 0.2, canvas.width * 0.2, canvas.height * 0.8, canvas.width, canvas.height * 0.9);
        ctx.stroke();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
</script>

</body>
</html>